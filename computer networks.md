## 计算机网络性能指标

> 速率、带宽、吞吐量、时延、时延带宽积、往返时间（RTT）、利用率

### 时延

> 处理时延、排队时延、发送时延（传输时延）、传播时延







## TCP/IP协议简介

互联网协议族（Internet Protocol Suite，缩写IPS）是一个网络通信模型。它常被通称为**TCP/IP协议族**。由于在网络通讯协议普遍采用分层的结构，当多个层次的协议共同工作时，类似计算机科学中的堆栈，因此又被称为**TCP/IP协议栈**

TCP/IP是一个四层体系结构，它从高到低包括**应用层、运输层、网际层和网络接口层**。高层逻辑上与用户更为接近，所处理数据更为抽象，它们依赖于低层将数据转换成最终能够进行实体控制的形式。

TCP/IP提供点对点的链接机制，将数据应该如何封装、定址、传输、路由以及在目的地如何接收加以标准化。常被称为简化的七层OSI模型。

![图片.png](https://upload-images.jianshu.io/upload_images/1732196-5449fa63962cb777.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

    注：五层协议的体系结构只是为了讲解网络原理而设计的，实际应用还是TCP/IP四层体系结构。

![图片.png](https://upload-images.jianshu.io/upload_images/1732196-56b7723bc4aa37e0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


### 应用层

提供OSI用户服务，即确定进程之间通信的性质，以满足用户需要以及提供网络与用户应用软件之间的接口服务。

一些特定的程序被认为运行在这个层上。它们提供服务直接支持用户应用。这些程序和它们对应的协议包括[HTTP](https://zh.wikipedia.org/wiki/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE "超文本传输协议")（万维网服务）、[FTP](https://zh.wikipedia.org/wiki/%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE "文件传输协议")（文件传输）、[SMTP](https://zh.wikipedia.org/wiki/%E7%AE%80%E5%8D%95%E9%82%AE%E4%BB%B6%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE "简单邮件传输协议")（电子邮件）、[SSH](https://zh.wikipedia.org/wiki/Secure_Shell "Secure Shell")（安全远程登陆）、[DNS](https://zh.wikipedia.org/wiki/%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F "域名系统")（名称<-> IP地址寻找）以及许多其他协议。 一旦从应用程序来的数据被编码成一个标准的应用层协议，它将被传送到IP栈的下一层。

每一个应用层协议一般都会使用到两个传输层协议之一： 面向连接的[TCP传输控制协议](https://zh.wikipedia.org/wiki/%E4%BC%A0%E8%BE%93%E6%8E%A7%E5%88%B6%E5%8D%8F%E8%AE%AE "传输控制协议")和无连接的包传输的[UDP用户数据报文协议](https://zh.wikipedia.org/wiki/%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%8D%8F%E8%AE%AE "用户数据报协议")。

**1). TCP对应的应用层协议**

 **FTP**：定义了文件传输协议，使用21端口。常说某某计算机开了FTP服务便是启动了文件传输服务。下载文件，上传主页，都要用到FTP服务。

**Telnet**：它是一种用于远程登陆的端口，用户可以以自己的身份远程连接到计算机上，通过这种端口可以提供一种基于DOS模式下的通信服务。如以前的BBS是-纯字符界面的，支持BBS的服务器将23端口打开，对外提供服务。

**SMTP**：定义了简单邮件传送协议，现在很多邮件服务器都用的是这个协议，用于发送邮件。如常见的免费邮件服务中用的就是这个邮件服务端口，所以在电子邮件设置-中常看到有这么SMTP端口设置这个栏，服务器开放的是25号端口。

**POP3**：它是和SMTP对应，POP3用于接收邮件。通常情况下，POP3协议所用的是110端口。也是说，只要你有相应的使用POP3协议的程序（例如Fo-xmail或Outlook），就可以不以Web方式登陆进邮箱界面，直接用邮件程序就可以收到邮件（如是163邮箱就没有必要先进入网易网站，再进入自己的邮-箱来收信）。

**HTTP**：从Web服务器传输超文本到本地浏览器的传送协议。

**2). UDP对应的应用层协议**

**DNS**：用于域名解析服务，将域名地址转换为IP地址。DNS用的是53号端口。

**TFTP**(Trival File Transfer Protocal)：简单文件传输协议，该协议在熟知端口69上使用UDP服务。

**SNMP**：简单网络管理协议，使用161号端口，是用来管理网络设备的。由于网络设备很多，无连接的服务就体现出其优势。

### 传输层

传输层能够解决诸如端到端可靠性（“数据是否已经到达目的地？”）和保证数据按照正确的顺序到达这样的问题。在TCP/IP协议组中，传输协议也包括所给数据应该送给哪个应用程序。

该层主要使用**TCP（传输控制协议）**和**UDP（用户数据报协议）**这两个协议。

**UDP报文段结构：**

![image-20201230222841103](C:\Users\aduncmj\AppData\Roaming\Typora\typora-user-images\image-20201230222841103.png)



**TCP报文段结构**

![摘自 计算机网络(第7版)-谢希仁](https://gitee.com/aduncmj/PictureBed/raw/master/images/20201213224800.png)





### 网络层

网络层提供**路由和寻址**的功能，使两终端系统能够互连且决定最佳路径，并具有一定的拥塞控制和流量控制的能力。由于TCP/IP协议体系中的网络层功能由IP协议规定和实现，故又称IP层。

**IP数据报格式：**

![TCP报文段结构，摘自 计算机网络(第7版)-谢希仁](https://gitee.com/aduncmj/PictureBed/raw/master/images/20201213224801.png)





### 数据链路层

负责在两个相邻结点间的线路上，无差错地传送以帧为单位的数据，并进行流量控制。每一帧包括一定数量的数据和一些必要的控制信息。与物理层相似，数据链路层要负责建立、维持和释放数据链路的连接。



**以太网MAC帧格式**

![摘自 计算机网络(第7版)-谢希仁](https://gitee.com/aduncmj/PictureBed/raw/master/images/20201213224802.png)



### 物理层

物理层规定:为传输数据所需要的物理链路创建、维持、拆除，而提供具有机械的，电子的，功能的和规范的特性。简单的说，物理层确保原始的数据可在各种物理媒体上传输。



### 数据传输经过的各层协议过程

![摘自 计算机网络(第7版)-谢希仁](https://gitee.com/aduncmj/PictureBed/raw/master/images/20201213224803.png)



以太网驱动程序首先根据以太网首部中的“上层协议”字段确定该数据帧的有效载荷（payload，指除去协议首部之外实际传输的数据）是IP、ARP  还是RARP 协议的数据报，然后交给相应的协议处理。假如是IP 数据报，IP 协议再根据IP  首部中的“上层协议”字段确定该数据报的有效载荷是TCP、UDP、ICMP 还是IGMP，然后交给相应的协议处理。假如是TCP  段或UDP段，TCP 或UDP 协议再根据TCP 首部或UDP 首部的“端口号”字段确定应该将应用层数据交给哪个用户进程。IP  地址是标识网络中不同主机的地址，而端口号就是同一台主机上标识不同进程的地址，IP 地址和端口号合起来标识网络中唯一的进程。

虽然IP、ARP 和RARP  数据报都需要以太网驱动程序来封装成帧，但是从功能上划分，ARP 和RARP 属于链路层，IP 属于网络层。虽然ICMP、IGMP、TCP、UDP  的数据都需要IP 协议来封装成数据报，但是从功能上划分，ICMP、IGMP 与IP 同属于网络层，TCP 和UDP属于传输层。



## 扩展

### VLAN
**前言**

> 虚拟局域网（VLAN）是一组逻辑上的设备和用户，这些设备和用户并不受物理位置的限制，可以根据功能、部门及应用等因素将它们组织起来，相互之间的通信就好像它们在[同一个网段](https://baike.baidu.com/item/%E5%90%8C%E4%B8%80%E4%B8%AA%E7%BD%91%E6%AE%B5/10612240)中一样，由此得名虚拟局域网。 VLAN是一种比较新的技术，工作在[OSI参考模型](https://baike.baidu.com/item/OSI%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B)的第2层和第3层，一个VLAN就是一个[广播域](https://baike.baidu.com/item/%E5%B9%BF%E6%92%AD%E5%9F%9F/5293530)，VLAN之间的通信是通过第3层的[路由器](https://baike.baidu.com/item/%E8%B7%AF%E7%94%B1%E5%99%A8/108294)来完成的。与传统的[局域网技术](https://baike.baidu.com/item/%E5%B1%80%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/2597024)相比较，VLAN技术更加灵活，它具有以下优点： 网络设备的移动、添加和修改的管理开销减少；可以控制[广播](https://baike.baidu.com/item/%E5%B9%BF%E6%92%AD/656406)活动；可提高[网络](https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C/143243)的安全性。

**正文**

**一、VLAN基本概念**

**1 VLAN概述**

- 将一个物理的LAN在逻辑上划分成多个广播域的通信技术
- 将广播报文限制在一个VLAN内

![](https://gitee.com/aduncmj/PictureBed/raw/master/images/20201213224804.png)



> 本例中，原本属于同一广播域的主机被划分到了两个VLAN中，即，VLAN1和VLAN2。VLAN内部的主机可以直接在二层互相通信，VLAN1和VLAN2之间的主机无法直接实现二层通信。

- 特点
  - 限制广播域：广播域被限制在一个VLAN内，从而节省了带宽、提高了网络处理能力。
  - 增强局域网的安全性：不同VLAN内的报文在传输时是相互隔离的，即一个VLAN内的用户不能与其它VLAN内的用户直接通信。
  - 提高了网络的健壮性：故障被限制在一个VLAN内，本VLAN内的故障不会影响其他VLAN的正常工作。
  - 灵活构建虚拟工作组：用VLAN可以划分不同的用户到不同的工作组，同一工作组的用户也不必局限于某一固定的物理范围，网络构建和维护更方便灵活。

**2 VLAN帧格式**

- VLAN Tag
  - 标识所属VLAN
  - 遵循IEEE 802.1Q标准
  - 支持802.1Q协议的交换机既可以收发有标记帧，也可以收发无标记帧
  - 交换机内部的数据包一律携带Tag

![](https://gitee.com/aduncmj/PictureBed/raw/master/images/20201213224805.png)



- IEEE 802.1Q
  - IEEE 802.1Q是虚拟桥接局域网的正式标准，对Ethernet帧格式进行了修改，在源MAC地址字段和协议类型字段之间加入4字节的802.1Q Tag。
- 802.1q Tag各字段含义
  - TPID：长度为2字节，表示帧类型。取值为0x8100时表示802.1q Tag帧。如果不支持802.1Q的设备收到这样的帧，会将其丢弃。
  - PRI：Priority，长度为3比特，表示帧的优先级，取值范围为0～7，值越大优先级越高。一般情况下，当交换机部署QoS时，优先发送优先级高的数据帧。
  - CFI：Canonical Format Indicator，长度为1比特，表示MAC地址是否是经典格式。CFI为0说明是经典格式，CFI为1表示为非经典格式。用于区分以太网帧、FDDI（Fiber Distributed Digital Interface）帧和令牌环网帧。在以太网中，CFI的值为0。
  - VID：VLAN ID，长度为12比特，表示该帧所属的VLAN。
- 每台支持802.1Q协议的交换机都可以发送包含VLAN ID的数据包，以指明自己属于哪一个VLAN。因此，在一个VLAN交换网络中，以太网帧有以下两种形式：
  - 有标记帧（tagged frame）：加入了4字节802.1Q Tag的帧。
  - 无标记帧（untagged frame）：原始的、未加入4字节802.1Q Tag的帧。



### 网卡、MAC和PHY

#### 网卡概述

**网络适配器**又称**网卡**或**网络接口卡**(NIC，Network  Interface Card)。它是使计算机联网的设备，插在计算机主板插槽中，PC机通过它来与LAN进行连接通信。

一块网卡包括OSI 模型的两个层，物理层和数据链路层：

- 物理层定义了数据传送与接收所需要的电与光信号、线路状态、时钟基准、数据编码和电路等，并向数据链路层设备提供标准接口。
- 数据链路层则提供寻址机构、数据帧的构建、数据差错检查、传送控制、向网络层提供标准的数据接口等功能。

数据在计算机总线中传输是并行方式即数据是肩并肩传输的，而在网络的物理缆线中说数据以串行的比特流方式传输的，**网卡承担串行数据和并行数据间的转换**。

由于网络上的数据速率和计算机总线上的速率并不相同，因此在**适配器中必须装有对数据进行缓存的存储器**。网卡还要能够实现以太网协议，**将数据组装成帧或拆装**。当适配器收到有差错的帧时，就把这个帧直接丢弃而不必通知计算机。当适配器收到正确的帧时，它就**使用中断**来通知该计算机，并交付协议栈中的网络层。当计算机要发送IP数据报时，就由协议栈把IP数据报向下交给适配器，组装成帧后发送到局域网。

在主板上插入适配器时，还必须把管理该适配器的设备驱动程序安装在计算机的操作系统中。这个驱动程序以后就会告诉适配器，应当从存储器的什么位置上把多长的数据块发送到局域网，或者应当在存储器的什么位置上把局域网传送过来的数据块存储下来。

![](https://gitee.com/aduncmj/PictureBed/raw/master/images/20201213224806.png)



#### **网卡的组成**

**以太网卡中数据链路层的芯片一般简称之为 MAC 控制器，物理层的芯片我们简称之为PHY，MAC和PHY是网卡的主要组成部分。**许多网卡的芯片把MAC 和PHY 的功能做到了一颗芯片中，其主体结构如图1所示，但是MAC 和PHY 的机制还是单独存在的，只是外观的表现形式是一颗单芯片。当然也有很多网卡的MAC 和PHY 是分开做的，如图2所示。

![](https://gitee.com/aduncmj/PictureBed/raw/master/images/20201213224808.jpg)

图1：MAC和PHY集成在一颗芯片的以太网卡

![](https://gitee.com/aduncmj/PictureBed/raw/master/images/20201213224807.jpg)

图2：MAC和PHY分开的以太网卡



上图中各部件为:

①**RJ-45接口**：是采用双绞线作为传输媒介的一种网卡接口

②**隔离变压器（数据泵）**：它在一块网卡上所起的作用主要有两个,一是传输数据,它把 PHY 送出来的差分信号用差模耦合的线圈耦合滤波以增强信号,并且通过电磁场的转换耦合到不同电平的连接网线的另外一端;一是隔离网线连接的不同网络设备间的不同电平,以防止不同电压通过网线传输损坏设备.除此而外,还能对设备起到一定的防雷保护作用

③、④**主控芯片（MAC和PHY)**：网卡的主控制芯片是网卡的核心元件，一块网卡性能的好坏和功能的强弱多寡，主要就是看这块芯片的质量

⑤**EEPROM**：各种网卡的状态和网卡的信息等数据都存在这颗小小的eeprom里,通过它来自动设置.里面记录了网卡芯片的供应商ID,子系 统供应商ID,网卡的MAC**地址**,网卡的一些配置,如SMI总线上PHY的地址,BOOTROM的容量, 是否启用BOOTROM引导系统等东西

⑥**BOOTROM插槽**：如无特殊要求网卡中的这个插槽处在空置状态.一般是和boot rom芯片搭配使用,其主要作用是引导电脑通过服务器引导进入操作系统.boot rom就是启动芯片,让电脑可以在不具备硬盘,软驱和光驱的情况下,直接通过服务器开机,成为一个无硬盘无软驱的工作站.没有软驱就无法将资料输出,这样也可以达到资料保密的功能.同时,还可以节省下购买这些电脑部件的费用.在使用bootrom时要注意自己使用何种网络操作系统,通常有boot rom for nt,boot rom for unix,boot rom for netware等,boot rom启动芯片要自行购买

⑦**WOL接头**：有些网卡会有WOL的功能, WOL网络开机的功能(wake on LAN).它可由另外一台电脑,使用软件制作特殊格式的信息包发送至一台装有具wol功能网卡的电脑,而该网卡接收到这些特殊格式的信息包后,就会命令电脑打开电源,目前已有越来越多的网卡支持网络开机的功能.

⑧**晶振**：负责产生网卡所有芯片的运算时钟,其原理就象主板上的晶体震荡器一样,通常网卡是使用20或25hz的晶体震荡器.千兆网卡使用62.5MHz或者125MHz晶振

⑨**电压转换芯片**：大多数网卡现在都使用3.3V或更低的电压.有的是双电压的.因此需要电源转换电路

⑩**LED指示灯**：在网卡后方会有二到三个不等的信号灯,其作用是显示目前网络的连线状态,通常具有tx和rx两个信息.tx代表正在送出资料,rx代表正在接收资料,若看到两个灯同时亮则代表目前是处于全双工的运作状态,也可由此来辨别全双工的网卡是否处于全双工的网络环境中.也有部分低速网卡只用一个灯来表示信号,通过不同的灯光变换来表示网络是否导通.

#### MAC控制器

MAC即Media Access  Control,即媒体访问控制子层协议.该协议位于OSI七层协议中数据链路层的下半部分,主要负责控制与连接物理层的物理介质.在发送数据的时候,MAC协议可以事先判断是否可以发送数据,如果可以发送将给数据加上一些控制信息,最终将数据以及控制信息以规定的格式发送到物理层;在接收数据的时候,MAC协议首先判断输入的信息并是否发生传输错误,如果没有错误,则去掉控制信息发送至LLC层.该层协议是以太网MAC由IEEE-802.3以太网标准定义.

以太网数据链路层其实包含MAC(介质访问控制)子层和LLC(逻辑链路控制)子层.一块以太网卡MAC芯片的作用不但要实现MAC子层和LLC子层的功能,**还要提供符合规范的PCI界面以实现和主机的数据交换**.

MAC从PCI总线收到IP数据包(或者其他网络层协议的数据包)后,将之拆分并重新打包成最大1518Byte,最小64Byte的帧.这个帧里面包括了目标MAC地址、自己的源MAC地址和数据包里面的协议类型(比如IP数据包的类型用80表示).最后还有一个DWORD(4Byte)的CRC码.

可是目标的MAC地址是哪里来的呢?这牵扯到一个ARP协议(介乎于网络层和数据链路层的一个协议).**第一次传送某个目的IP地址的数据的时候,先会发出一个ARP包,其MAC的目标地址是广播地址**,里面说到：”谁是xxx.xxx.xxx.xxx这个IP地址的主人？”因为是广播包,所有这个局域网的主机都收到了这个ARP请求.收到请求的主机将这个IP地址和自己的相比较,如果不相同就不予理会,如果相同就发出ARP响应包.这个IP地址的主机收到这个ARP请求包后回复的ARP响应里说到:”我是这个IP地址的主人”.这个包里面就包括了他的MAC地址.以后的给这个IP地址的帧的目标MAC地址就被确定了.(其它的协议如IPX/SPX也有相应的协议完成这些操作.)

**IP地址和MAC地址之间的关联关系保存在主机系统里面,叫做ARP表,由驱动程序和操作系统完成**.**在Microsoft的系统里面可以用arp-a的命令查看ARP表**.收到数据帧的时候也是一样,做完CRC以后,如果没有CRC效验错误,就把帧头去掉,把数据包拿出来通过标准的借口传递给驱动和上层的协议客栈,最终正确的达到我们的应用程序.

还有一些控制帧,例如流控帧也需要MAC直接识别并执行相应的行为.

以太网MAC芯片的一端接计算机PCI总线,另外一端就接到PHY芯片上,它们之间是通过MII接口链接的.

![](https://gitee.com/aduncmj/PictureBed/raw/master/images/20201213224811.png)

#### 什么是MII?

MII即媒体独立接口,它是IEEE-802.3定义的以太网行业标准."媒体独立"表明在不对MAC硬件重新设计或替换的情况下,任何类型的PHY设备都可以正常工作.它包括一个数据接口,以及一个MAC和PHY之间的管理接口.

- 数据接口包括分别用于发送器和接收器的两条独立信道.每条信道都有自己的数据,时钟和控制信号.MII数据接口总共需要16个信号,包括TX_ER,TXD<3:0>,TX_EN,TX_CLK,   COL,RXD<3:0>,RX_EX,RX_CLK,CRS,RX_DV等.MII以4位半字节方式传送数据双向传输,时钟速率25MHz.其工作速率可达100Mb/s;
- MII管理接口是个双信号接口,一个是时钟信号,另一个是数据信号.通过管理接口,上层能监视和控制PHY.其管理是使用SMI(Serial  Management  Interface)总线通过读写PHY的寄存器来完成的.PHY里面的部分寄存器是IEEE定义的,这样PHY把自己的目前的状态反映到寄存器里面,**MAC通过SMI总线不断的读取PHY的状态寄存器以得知目前PHY的状态,例如连接速度,双工的能力等**.当然也可以通过SMI设置PHY的寄存器达到控制的目的,例如流控的打开关闭,自协商模式还是强制模式等.不论是物理连接的MII总线和SMI总线还是PHY的状态寄存器和控制寄存器都是有IEEE的规范的,因此不同公司的MAC和PHY一样可以协调工作.当然为了配合不同公司的PHY的自己特有的一些功能,驱动需要做相应的修改.

**MII**支持10Mbps和100Mbps的操作,一个接口由14根线组成,它的支持还是比较灵活的,但是有一个缺点是因为它一个端口用的信号线太多,如果一个8端口的交换机要用到112根线,16端口就要用到224根线,到32端口的话就要用到448根线,一般按照这个接口做交换机,是不太现实的,所以现代的交换机的制作都会用到其它的一些从MII简化出来的标准,比如RMII,SMII,GMII等.

**RMII**是简化的MII接口,在数据的收发上它比MII接口少了一倍的信号线,所以它一般要求是50MHz的总线时钟.RMII一般用在多端口的交换机,它不是每个端口安排收,发两个时钟,而是所有的数据端口公用一个时钟用于所有端口的收发,这里就节省了不少的端口数目.RMII的一个端口要求7个数据线,比MII少了一倍,所以交换机能够接入多一倍数据的端口.和MII一样,RMII支持10Mbps和100Mbps的总线接口速度.

**SMII**是由思科提出的一种媒体接口,它有比RMII更少的信号线数目,S表示串行的意思.因为它只用一根信号线传送发送数据,一根信号线传输接受数据,所以为了满足100Mbps的总线接口速度的需求,它的时钟频率就达到了125MHz,为什么用125MHz,是因为数据线里面会传送一些控制信息.SMII一个端口仅用4根信号线完成100Mbps的传输,比起RMII差不多又少了一倍的信号线.SMII在工业界的支持力度是很高的.同理,所有端口的数据收发都公用同一个外部的125MHz时钟.

**GMII**是千兆网的MII接口,这个也有相应的RGMII接口,表示简化了的GMII接口,GMII采用8位接口数据,工作时钟125MHz,因此传输速率可达1000Mbps.同时兼容MII所规定的10/100 Mbps工作方式.

![](https://gitee.com/aduncmj/PictureBed/raw/master/images/20201213224809.png)

> MII接口详细信息及PHY寄存器信息参考：[Ethernet（以太网）之一 详解 MAC、MII、PHY](https://blog.csdn.net/ZCShouCSDN/article/details/80090802)



#### PHY

PHY是物理接口收发器,它实现物理层.IEEE-802.3标准定义了以太网PHY.包括MII/GMII(介质独立接口)子层,PCS(物理编码子层),PMA(物理介质附加)子层,PMD(物理介质相关)子层,MDI子层.它符合IEEE-802.3k中用于10BaseT(第14条)和100BaseTX(第24条和第25条)的规范.

![](https://gitee.com/aduncmj/PictureBed/raw/master/images/20201213224812.png)

PHY在发送数据的时候,收到MAC过来的数据(**对PHY来说,没有帧的概念,对它来说,都是数据而不管什么地址,数据还是CRC.对于100BaseTX因为使用4B/5B编码,每4bit就增加1bit的检错码**),然后把**并行数据转化为串行流数据**,再按照物理层的编码规则把数据编码,再变为模拟信号把数据送出去.收数据时的流程反之.PHY还有个重要的功能就是**实现CSMA/CD的部分功能.**它可以检测到网络上是否有数据在传送,如果有数据在传送中就等待,一旦检测到网络空闲,再等待一个随机时间后将送数据出去.如果两个碰巧同时送出了数据,那样必将造成冲突,这时候,冲突检测机构可以检测到冲突,然后各等待一个随机的时间重新发送数据.这个随机时间很有讲究的,并不是一个常数,在不同的时刻计算出来的随机时间都是不同的,而且有多重算法来应付出现概率很低的同两台主机之间的第二次冲突.

许多网友在接入Internt宽带时,喜欢使用”抢线”强的网卡,就是因为不同的PHY碰撞后计算随机时间的方法设计上不同,使得有些网卡比较”占便宜”.不过,抢线只对广播域的网络而言的,对于交换网络和ADSL这样点到点连接到局端设备的接入方式没什么意义.而且”抢线”也只是相对而言的,不会有质的变化.

现在交换机的普及使得交换网络的普及,使得冲突域网络少了很多,极大地提高了网络的带宽.但是如果用HUB,或者共享带宽接入Internet的时候还是属于冲突域网络,有冲突碰撞的.交换机和HUB最大的区别就是:一个是构建点到点网络的局域网交换设备,一个是构建冲突域网络的局域网互连设备.

除此之外**PHY还提供了和对端设备连接的重要功能并通过LED灯显示出自己目前的连接的状态和工作状态**让我们知道.**当我们给网卡接入网线的时候,PHY不断发出的脉冲信号检测到对端有设备,它们通过标准的”语言”交流,互相协商并确定连接速度、双工模式、是否采用流控等**.通常情况下,协商的结果是两个设备中能同时支持的最大速度和最好的双工模式.这个技术被称为AutoNegotiation或者NWAY,它们是一个意思–自动协商.

具体传输过程为,发送数据时,网卡首先侦听介质上是否有载波(载波由电压指示),如果有,则认为其他站点正在传送信息,继续侦听介质.一旦通信介质在一定时间段内(称为帧间缝隙IFG=9.6微秒)是安静的,即没有被其他站点占用,则开始进行帧数据发送,同时继续侦听通信介质,以检测冲突.在发送数据期间,如果检测到冲突,则立即停止该次发送,并向介质发送一个“阻塞”信号,告知其他站点已经发生冲突,从而丢弃那些可能一直在接收的受到损坏的帧数据,并等待一段随机时间(CSMA/CD确定等待时间的算法是二进制指数退避算法).在等待一段随机时间后,再进行新的发送.如果重传多次后(大于16次)仍发生冲突,就放弃发送.接收时,网卡浏览介质上传输的每个帧,如果其长度小于64字节,则认为是冲突碎片.如果接收到的帧不是冲突碎片且目的地址是本地地址,则对帧进行完整性校验,如果帧长度大于1518字节(称为超长帧,可能由错误的LAN驱动程序或干扰造成)或未能通过CRC校验,则认为该帧发生了畸变.通过校验的帧被认为是有效的,网卡将它接收下来进行本地处理.









> 参考文章：
>
> [网卡工作原理详解](<https://blog.csdn.net/tao546377318/article/details/51602298>)
>
> [[网口扫盲一:网卡初步认识](https://www.cnblogs.com/jason-lu/p/3198424.html)](https://www.cnblogs.com/jason-lu/p/3198424.html)
>
> [[网口扫盲二:Mac与Phy组成原理的简单分析](https://www.cnblogs.com/jason-lu/p/3196096.html)](https://www.cnblogs.com/jason-lu/p/3196096.html)
>
> [[网口扫盲三:以太网芯片MAC和PHY的关系](https://www.cnblogs.com/jason-lu/p/3195473.html)](https://www.cnblogs.com/jason-lu/p/3195473.html)



### WAN、LAN、VLAN、WLAN、WIFI、VPN分别是什么

[WAN、LAN、VLAN、WLAN、WIFI、VPN分别是什么](https://www.cnblogs.com/frisk/p/11603352.html)



### 零散知识点

---

- **局域网与广域网**皆属第1、2层。
- **MAC地址**（英语：Media Access Control Address），直译为媒体访问控制地址，也称物理地址（Physical Address），它是一个用来确认网络设备位置的地址。MAC地址用于在网络中唯一标示一个网卡，一台设备若有一或多个网卡，则每个网卡都需要并会有一个唯一的MAC地址。
- **网卡**是一块被设计用来允许计算机在计算机网络上进行通讯的计算机硬件。它使得用户可以通过电缆或无线相互连接。每一个网卡都有一个被称为MAC地址的独一无二的48位串行号，它被写在卡上的一块ROM中。
- **网关**也经常指把一种[协议](https://zh.wikipedia.org/wiki/%E5%8D%8F%E8%AE%AE "协议")转成另一种协议的设备。在今天很多局域网采用都是路由来接入网络，因此现在通常指的网关就是路由器的IP。但在现代网络术语中，网关（gateway）与路由器（router）的定义不同。网关（gateway）能在不同[协议](https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE "网络传输协议")间移动数据，而路由器（router）是在不同[网络](https://zh.wikipedia.org/wiki/%E7%B6%B2%E8%B7%AF "网络")间移动数据，相当于传统所说的IP网关（IP gateway）。
- **内网IP**：[192.168.和10.0.开头的IP、内网IP段、IP简介、分类——（IP观止）](https://blog.csdn.net/superit401/article/details/78246298)



## 常见问题

### 在浏览器中输入www.google.com后执行的全部过程 √

参考《计算机网络  自顶向下方法  原书第6版》中的 P329-P333。



### 路由设备与相关层

物理层：中继器（Repeater，也叫放大器），集线器。

数据链路层：网桥，交换机。

网络层：路由器。

### 常见的路由选择协议，以及它们的区别

常见的路由选择协议有：RIP协议、OSPF协议。

**RIP协议**：底层是贝尔曼福特算法，它选择路由的度量标准（metric)是跳数，最大跳数是15跳，如果大于15跳，它就会丢弃数据包。

**OSPF协议**：底层是迪杰斯特拉算法，是链路状态路由选择协议，它选择路由的度量标准是带宽，延迟。



### 特殊的IP地址

（1）网络地址

IP地址由网络号（包括子网号）和主机号组成，网络地址的主机号为全0，网络地址代表着整个网络。

（2）广播地址

广播地址通常称为直接广播地址，是为了区分受限广播地址。

广播地址与网络地址的主机号正好相反，广播地址中，主机号为全1。当向某个网络的广播地址发送消息时，该网络内的所有主机都能收到该广播消息。

（3）组播地址

D类地址就是组播地址。

先回忆下A，B，C，D类地址吧

A类地址以00开头，第一个字节作为网络号，地址范围为：0.0.0.0~127.255.255.255；

B类地址以10开头，前两个字节作为网络号，地址范围是：128.0.0.0~191.255.255.255;

C类地址以110开头，前三个字节作为网络号，地址范围是：192.0.0.0~223.255.255.255。

D类地址以1110开头，地址范围是224.0.0.0~239.255.255.255，D类地址作为组播地址（一对多的通信）；

E类地址以1111开头，地址范围是240.0.0.0~255.255.255.255，E类地址为保留地址，供以后使用。

Notice：只有A,B,C有网络号和主机号之分，D类地址和E类地址没有划分网络号和主机号。

（4）255.255.255.255

该IP地址指的是受限的广播地址。受限广播地址与一般广播地址（直接广播地址）的区别在于，受限广播地址之只能用于本地网络，路由器不会转发以受限广播地址为目的地址的分组；一般广播地址既可在本地广播，也可跨网段广播。例如：主机192.168.1.1/30上的直接广播数据包后，另外一个网段192.168.1.5/30也能收到该数据报；若发送受限广播数据报，则不能收到。

Notice：一般的广播地址（直接广播地址）能够通过某些路由器（当然不是所有的路由器），而受限的广播地址不能通过路由器。

（5）0.0.0.0

常用于寻找自己的IP地址，例如在我们的RARP，BOOTP和DHCP协议中，若某个未知IP地址的无盘机想要知道自己的IP地址，它就以255.255.255.255为目的地址，向本地范围（具体而言是被各个路由器屏蔽的范围内）的服务器发送IP请求分组。

（6）回环地址

127.0.0.0/8被用作回环地址，回环地址表示本机的地址，常用于对本机的测试，用的最多的是127.0.0.1。

（7）A、B、C类私有地址

私有地址(private address)也叫专用地址，它们不会在全球使用，只具有本地意义。

A类私有地址：10.0.0.0/8，范围是：10.0.0.0~10.255.255.255

B类私有地址：172.16.0.0/12，范围是：172.16.0.0~172.31.255.255

C类私有地址：192.168.0.0/16，范围是：192.168.0.0~192.168.255.255



### NAT协议、DHCP协议、DNS协议的作用

**NAT协议**：网络地址转换(NAT,Network AddressTranslation)属接入广域网(WAN)技术，是一种将私有（保留）地址转化为合法IP地址的转换技术，它被广泛应用于各种类型Internet接入方式和各种类型的网络中。原因很简单，NAT不仅完美地解决了lP地址不足的问题，而且还能够有效地避免来自网络外部的攻击，隐藏并保护网络内部的计算机。

**DHCP协议**：动态主机设置协议（Dynamic Host ConfigurationProtocol, DHCP）是一个局域网的网络协议，使用UDP协议工作，主要有两个用途：给内部网络或网络服务供应商自动分配IP地址，给用户或者内部网络管理员作为对所有计算机作中央管理的手段。

**DNS协议**：DNS 是域名系统 (Domain Name System) 的缩写，是因特网的一项核心服务，它作为可以将域名和IP地址相互映射的一个分布式数据库，能够使人更方便的访问互联网，而不用去记住能够被机器直接读取的IP数串。

### ICMP 协议？

ICMP 是 Internet Control Message Protocol ，因特网控制报文协议。它是 TCP/IP 协议族的一个子协议，用于在 IP 主机、路由器之间传递控制消息。控制消息是指网络通不通、主机是否可达、路由器是否可用等网络本身的消息。这些控制消息虽然并不传输用户数据，但是对于用户数据的传递起着重要的作用。 ICMP 报文有两种：差错报告报文和询问报文。

### DNS （ Domain Name System ）域名系统工作原理。

当 DNS 客户机需要在程序中使用名称时，它会查询 DNS 服务器来解析该名称。客户机发送的每条查询信息包括三条信息：包括：指定的 DNS 域名，指定的查询类型， DNS 域名的指定类别。基于 UDP 服务，端口 53\. 该应用一般不直接为用户使用，而是为其他应用服务，如 HTTP ， SMTP 等在其中需要完成主机名到 IP 地址的转换。

### 请问交换机和路由器分别的实现原理是什么？分别在哪个层次上面实现的？

交换机用于局域网，利用主机的 MAC 地址进行数据传输，而不需要关心 IP 数据包中的 IP 地址，它工作于数据链路层。路由器识别网络是通过 IP 数据包中 IP 地址的网络号进行的，所以为了保证数据包路由的正确性，每个网络都必须有一个唯一的网络号。路由器通过 IP 数据包的 IP 地址进行路由的（将数据包递交给哪个下一跳路由器）。路由器工作于网络层。由于设备现在的发展，现在很多设备既具有交换又具有路由功能，两者的界限越来越模糊。

### 面向连接和非面向连接的服务的特点是什么？

面向连接的服务，通信双方在进行通信之前，要先在双方建立起一个完整的可以彼此沟通的通道，在通信过程中，整个连接的情况一直可以被实时地监控和管理。

非面向连接的服务，不需要预先建立一个联络两个通信节点的连接，需要通信的时候，发送节点就可以往网络上发送信息，让信息自主地在网络上去传，一般在传输的过程中不再加以监控。

### 电路交换、报文交换和分组交换的比较？

**电路交换**：公共电话网（ PSTN 网）和移动网（包括 GSM 和 CDMA 网） 采用的都是电路交换技术，它的基本特点是采用面向连接的方式，在双方进行通信之前，需要为通信双方分配一条具有固定宽带的通信电路，通信双方在通信过程中 一直占用所分配的资源，直到通信结束，并且在电路的建立和释放过程中都需要利用相关的信令协议。这种方式的优点是在通信过程中可以保证为用户提供足够的带 宽，并且实时性强，时延小，交换设备成本低，但同时带来的缺点是网络带宽利用率不高，一旦电路被建立不管通信双方是否处于通话状态分配的电路一直被占用。连接建立——数据传输——释放链接

**报文交换**：报文交换和分组交换类似，也采用存储转发机制，但报文交换是以报文作为传送单元，由于报文长度差异很大，长报文可能导致很大的时延，并且对每个节 点来说缓冲区的分配也比较困难，为了满足各种长度报文的需要并且达到高效的目的，节点需要分配不同大小的缓冲区，否则就有可能造成数据传送的失败。在实际 应用中报文交换主要用于传输报文较短，实时性要求较低的通信业务，如公用电报网，报文交换比分组交换出现的要早一些，分组交换是在报文交换的基础上，将报 文分割成分组进行传输，在传输时延和传输效率上进行了平衡。另外一个缺点是出错时，整个报文都将重传。

**分组交换**：电路交换技术主要适用于传送话音相关的业务，这种网络交换方式对于数据业务而言，有着很大的局限性。首先是数据通信具有较强的突发性，峰值比特率 和平均比特率相差较大，如果采用电路交换技术，若按峰值比特率分配电路带宽会造成资源的极大浪费，如果按平均比特率分配带宽，则会造成数据的大量丢失，其 次是和语音业务比较，数据业务对时延没有严格的要求，但是需要进行无差错的传输，而语音信号可以有一定程序的失真但实时性要高。分组交换技术就是针对数据 通信业务的特点而提出的一种交换方式，它的基本特点是面向无连接而采用存储转发的方式，将需要传送的数据按照一定长度分割成许多小段数据，并在数据之前增 加相应的用于对数据进行选路和校验等功能的头部字段，作为数据传送的基本单元，即分组。采用分组交换技术，在通信之前不需要建立连接，每个节点首先将前一 节点送来的分组收下并保存在缓冲区中，然后根据分组头部中的地址信息选择适当的链路将其发送至下一个节点，这样在通信过程中可以根据用户的要求和网络的能 力来动态分配带宽。分组交换比电路交换的电路利用率高，但时延较大。分组转发的带来的问题：带来排队时延以及增加头部带来的开销。



### 数据链路层协议可能提供的服务？

成帧、链路访问、透明传输、可靠交付、流量控制、差错检测、差错纠正、半双工和全双工。最重要的是帧定界（成帧）、透明传输以及差错检测。

### 帧定界？

帧定界就是确定帧的界限，其方法有：字节计数法、字符填充法、零比特填充法。

### PPP 协议工作过程？

用户拨号接入 ISP ， ISP 的调制解调器对拨号做出确认，并建立一条物理链路，用户向 ISP 的路由器发送一系列的 LCP 分组，这是为 PPP 选择一些参数，然后配置网络层， NCP 为新接入的 PC 分配一个临时的 IP 地址，这样用户 PC 就成为因特网上的主机，通信结束后， NCP 释放网络层连接收回 IP 地址，然后， LCP 释放数据链路层连接，最后释放物理层的连接。

### CSMA/CD ？

是指载波监听多点接入 / 碰撞检测

（ 1 ）多点接入是指多台计算机以多点接入的方式连接在一条总线上

（ 2 ）载波监听是指每一个站在发送数据之前首先要检查一下总线上是否已经有其他计算机在发送数据，如果有，则暂时不要发送，避免碰撞

（ 3 ）实际在总线上并没有什么载波，实际是采用电子技术检测总线上是否有其他计算机发送的数据信号

（ 4 ）碰撞检测就是计算机边发送数据边检测信道上的信号电压大小，当发生了碰撞即产生了冲突，碰撞检测也叫做“冲突检测”

（ 5 ）当发生了碰撞时，总线上传输的信号就产生了失真，无法恢复出有用的信息，因此为了不浪费网络资源，一旦检测到碰撞发生时，就停止数据发送。然后再等待一段随机时间后在发送。

（ 6 ）强化碰撞，当检测到碰撞后，不仅立即停止发送数据外，还要人为的发送一些干扰信息，让其他站也知道此时碰撞发生了。

（ 7 ）由于信号在总线上的传输也是需要一定的时间的，所以当一个站检测到总线是空闲的时候，也可能并非是真正的空闲，因为会存在其他站发送了数据，只是还没有传送到该站能检测的范围内。这种情况下，发送数据最终也会导致碰撞发生。

（ 8 ）工作原理

（ 81 ）发送前先监听信道是否空闲，若空闲则立即发送；

（ 82 ）如果信道忙，则继续监听，一旦空闲就立即发送；

（ 83 ）在发送过程中，仍需继续监听。若监听到冲突，则立即停止发送数据，然后发送一串干扰信号（ Jam ）；

（ 84 ）发送 Jam 信号的目的是强化冲突，以便使所有的站点都能检测到发生了冲突。等待一段随机时间（称为退避）以后，再重新尝试。

总结为四句话：发前先听，空闲即发送，边发边听，冲突时退避。

### 虚拟局域网 VLAN ？

（ 1 ） VLAN 只是局域网提供给用户的一种服务，而并不是一种新的局域网络。 VLAN 限制了接收广播消息的工作站数，使得网络不会因传播过多的广播信息（即广播风暴）而引起性能恶化。

（ 2 ）划分 VLAN 的方法：基于端口；基于 MAC 地址；基于 IP 地址。

### 运输层协议与网络层协议的区别？

网络层协议负责的是提供主机间的逻辑通信

运输层协议负责的是提供进程间的逻辑通信

### 网络按地域范围分类？

局域网、城域网、广域网。

### 网络按使用者分类？

公共网和专用网。